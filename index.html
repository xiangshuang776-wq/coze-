<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台湾命理动漫视频生成器</title>
    <style>
        body { font-family: 'PingFang SC', sans-serif; background: #1a1a2e; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: #16213e; padding: 30px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.5); width: 100%; max-width: 500px; text-align: center; }
        h1 { color: #e94560; margin-bottom: 20px; }
        input { width: 80%; padding: 12px; border-radius: 5px; border: none; margin-bottom: 20px; font-size: 16px; }
        button { background: #e94560; color: white; border: none; padding: 12px 30px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { background: #ff4d6d; }
        button:disabled { background: #555; cursor: not-allowed; }
        #result { margin-top: 30px; display: none; }
        video { width: 100%; border-radius: 10px; border: 2px solid #e94560; }
        .loading { display: none; color: #f9d423; margin: 20px 0; }
        .master-msg { font-style: italic; color: #00d2ff; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>命理动漫·自动排盘</h1>
    <div class="master-msg">“输入生肖，老师为你一键推演 30 秒开运天机。”</div>
    
    <input type="text" id="zodiacInput" placeholder="请输入生肖（如：龙）">
    <br>
    <button id="runBtn" onclick="runWorkflow()">开始推演</button>

    <div id="loading" class="loading">大师正在闭关赶制视频（由于是6段合成，预计需1-3分钟），请勿关闭窗口...</div>

    <div id="result">
        <h3>推演结果已出：</h3>
        <video id="outputVideo" controls></video>
        <br>
        <p><a id="videoLink" href="#" target="_blank" style="color: #00d2ff;">[ 点击下载原视频 ]</a></p>
    </div>
</div>

<script>
    async function runWorkflow() {
        const zodiac = document.getElementById('zodiacInput').value;
        const btn = document.getElementById('runBtn');
        const loading = document.getElementById('loading');
        const resultDiv = document.getElementById('result');
        const video = document.getElementById('outputVideo');
        const link = document.getElementById('videoLink');

        if (!zodiac) {
            alert("请先输入生肖，老师才好为你推演哦！");
            return;
        }

        // 状态更新
        btn.disabled = true;
        loading.style.display = 'block';
        resultDiv.style.display = 'none';

        // 核心配置：使用你刚才发给我的 API 和 Token
        const apiUrl = 'https://tjy7y8chct.coze.site/run';
        const token = 'eyJhbGciOiJSUzI1NiIsImtpZCI6IjhmNTU2YTNkLWNkMDItNDQ0Zi05ZTBkLTI0NTU0ZTVkYmYyZCJ9.eyJpc3MiOiJodHRwczovL2FwaS5jb3plLmNuIiwiYXVkIjpbIkdWUGRGRGhTZEJGMnZ2VGlWc1hhTmNyamdoMzZ1Y3JLIl0sImV4cCI6ODIxMDI2Njg3Njc5OSwiaWF0IjoxNzY5Nzk5NDUwLCJzdWIiOiJzcGlmZmU6Ly9hcGkuY296ZS5jbi93b3JrbG9hZF9pZGVudGl0eS9pZDo3NjAxMTM1MjYyNDIwMTcyODM2Iiwic3JjIjoiaW5ib3VuZF9hdXRoX2FjY2Vzc190b2tlbl9pZDo3NjAxMjMwNzYwODIwODY3MTA4In0.PaeHNixndF7hmhPvLWKLSjn7yDjGymvm_O39J6w2RoqBOiKRKJ5-NPS8NfN9LYmdtpWHH5tCSCZ_Q4EmBUSxUr0LEquOCmvCs_uUgDGvsVRuvefsrnqDzhC0vBg6ol_zAyPUpSQ2RHP8UujOiEiremsRaJrvU6sXxD7VAgxS7k_ivLGiZkjy9I0NNpZ5g2KmJIAQj2k81m5puNMKESL-HXev2J-kErDXHNJCuNYl3TdBBD9NjKZZEL-q2gNe5N6EvwzEpuGCpIuYQo4HeRSkiwwZV-aS2_rqRIAymTcEc_XEhzN2tchHeEIsoLUwy-SvoYDeOfFKHW9fA4rVWiqLQg';

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ "zodiac": zodiac })
            });

            const data = await response.json();

            // 解析逻辑：假设工作流返回的视频地址在 data.video_url 里
            // 如果你的工作流变量名不同，请修改此处
            const finalUrl = data.data?.video_url || data.video_url || data.data?.final_video_url;

            if (finalUrl) {
                video.src = finalUrl;
                link.href = finalUrl;
                resultDiv.style.display = 'block';
            } else {
                alert("视频生成失败，请检查工作流输出设置或稍后再试。");
            }
        } catch (error) {
            console.error('Error:', error);
            alert("连接大师失败（网络超时），请检查 API 是否开启异步模式。");
        } finally {
            btn.disabled = false;
            loading.style.display = 'none';
        }
    }
</script>

</body>
</html>
